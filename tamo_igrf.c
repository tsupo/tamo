/*
 *  tamo_igrf.c
 *          by H.Tsujimura  tsupo@na.rim.or.jp
 *                      7 March 2003
 *  Copyright (c) 1994, 2003, 2006, 2007  Hiroshi Tsujimura
 *  All Rights Reserved.
 *
 * History :
 * $Log: tamo_igrf.c $
 * Revision 1.12  2009/04/27  11:55:18  tsujimura543
 * 「メモ」と「課題」を記入
 *
 * Revision 1.11  2007/02/08  02:42:33  tsujimura543
 * igrf.exe のビルド時にもプロトタイプ宣言が有効になるようにした
 *
 * Revision 1.10  2007/02/06  10:51:53  tsujimura543
 * copyright 表記をアップデート
 *
 * Revision 1.9  2007/02/05  14:56:45  tsujimura543
 * プロトタイプ宣言を追加
 *
 * Revision 1.8  2006/05/30  02:33:57  tsujimura543
 * IGRF2005モデルに対応
 *
 * Revision 1.7  2003/11/11  07:02:19  tsujimura543
 * K&R 表記 → ANSI C 表記 に完全移行
 *
 * Revision 1.6  2003/11/05  09:46:34  tsujimura543
 * IGRF1980 と IGRF1985 に対応
 *
 * Revision 1.5  2003/10/30  08:13:54  tsujimura543
 * Another HTML-lint で評価が100点になるように修正
 *
 * Revision 1.4  2003/10/24  01:35:04  tsujimura543
 * Solaris9 上でコンパイル、動作確認
 *
 * Revision 1.3  2003/04/25  11:14:21  tsujimura543
 * ソースをきれいにする
 *
 * Revision 1.2  2003/04/25  11:11:24  tsujimura543
 * 磁気偏差の表示を　tamo.exe に組み込む
 *
 * Revision 1.1  1994/10/25  07:57:34  tuzimura
 * Initial revision
 *
 */

/*
 *  磁気偏差を求めるプログラム
 */

#ifdef  TEST
#include <stdio.h>
#include <stdlib.h>
#endif

#ifdef  TAMO
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "tamo.h"
#else
#ifdef	__STDC__
#define _(def)  def
#else
#define _(def)  ()
#endif
#endif

#include <math.h>
#ifndef M_PI
#define M_PI    3.14159265358979323846
#endif

#ifndef UNIX
long    irint( double d )
{
    return ( (long)floor( d ) );
}
#endif

#define isLeapYear(y)   (((y)%4 == 0) && (((y)%100 != 0) || ((y)%400 == 0)))

static int      days[] = {
    0, 31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334
};

/* メモ: IGRF 1900.0 以降のデータが
 *           http://www.ngdc.noaa.gov/IAGA/vmod/igrf10coeffs.txt
 *       にある
 * 課題: http://www.ngdc.noaa.gov/IAGA/vmod/igrf.html に合致するように
 *       修正した方がよいかもしれない
 */

static struct igrf1990table     {   /* IGRF1990 model パラメータテーブル */
    int     n;
    int     m;
    long    g1;                     /* 1990.0におけるG係数の値           */
    long    h1;                     /* 1990.0におけるH係数の値           */
    double  g2;                     /* 1990-95でのG係数の予想変位        */
    double  h2;                     /* 1990-95でのH係数の予想変位        */
}       igrf1990[] = {
    /* 理科年表 1993年版より */
    {  1,  0, -29775,     0,  18.0,   0.0 },
    {  1,  1,  -1851,  5411,  10.6, -16.1 },
    {  2,  0,  -2136,     0, -12.9,   0.0 },
    {  2,  1,   3058, -2278,   2.4, -15.8 },
    {  2,  2,   1693,  -380,   0.0, -13.8 },
    {  3,  0,   1315,     0,   3.3,   0.0 },
    {  3,  1,  -2240,  -287,  -6.7,   4.4 },
    {  3,  2,   1246,   293,   0.1,   1.6 },
    {  3,  3,    807,  -348,  -5.9, -10.6 },
    {  4,  0,    939,     0,   0.5,   0.0 },
    {  4,  1,    782,   248,   0.6,   2.6 },
    {  4,  2,    324,  -240,  -7.0,   1.8 },
    {  4,  3,   -423,    87,   0.5,   3.1 },
    {  4,  4,    142,  -299,  -5.5,  -1.4 },
    {  5,  0,   -211,     0,   0.6,   0.0 },
    {  5,  1,    353,    47,  -0.1,  -0.1 },
    {  5,  2,    244,   153,  -1.6,   0.5 },
    {  5,  3,   -111,  -154,  -3.1,   0.4 },
    {  5,  4,   -166,   -69,  -0.1,   1.7 },
    {  5,  5,    -37,    98,   2.3,   0.4 },
    {  6,  0,     61,     0,   1.3,   0.0 },
    {  6,  1,     64,   -16,  -0.2,   0.2 },
    {  6,  2,     60,    83,   1.8,  -1.3 },
    {  6,  3,   -178,    68,   1.3,   0.0 },
    {  6,  4,      2,   -52,  -0.2,  -0.9 },
    {  6,  5,     17,     2,   0.1,   0.5 },
    {  6,  6,    -96,    27,   1.2,   1.2 },
    {  7,  0,     77,     0,   0.6,   0.0 },
    {  7,  1,    -64,   -81,  -0.5,   0.6 },
    {  7,  2,      4,   -27,  -0.3,   0.2 },
    {  7,  3,     28,     1,   0.6,   0.8 },
    {  7,  4,      1,    20,   1.6,  -0.5 },
    {  7,  5,      6,    16,   0.2,  -0.2 },
    {  7,  6,     10,   -23,   0.2,   0.0 },
    {  7,  7,      0,    -5,   0.3,   0.0 },
    {  8,  0,     22,     0,   0.2,   0.0 },
    {  8,  1,      5,    10,  -0.7,   0.5 },
    {  8,  2,     -1,   -20,  -0.2,  -0.2 },
    {  8,  3,    -11,     7,   0.1,   0.3 },
    {  8,  4,    -12,   -22,  -1.1,   0.3 },
    {  8,  5,      4,    12,   0.0,   0.4 },
    {  8,  6,      4,    11,  -0.1,  -0.5 },
    {  8,  7,      3,   -16,  -0.5,  -0.3 },
    {  8,  8,     -6,   -11,  -0.6,   0.6 },
    {  9,  0,      4,     0,   0.0,   0.0 },
    {  9,  1,     10,   -21,   0.0,   0.0 },
    {  9,  2,      1,    15,   0.0,   0.0 },
    {  9,  3,    -12,    10,   0.0,   0.0 },
    {  9,  4,      9,    -6,   0.0,   0.0 },
    {  9,  5,     -4,    -6,   0.0,   0.0 },
    {  9,  6,     -1,     9,   0.0,   0.0 },
    {  9,  7,      7,     9,   0.0,   0.0 },
    {  9,  8,      2,    -7,   0.0,   0.0 },
    {  9,  9,     -6,     2,   0.0,   0.0 },
    { 10,  0,     -4,     0,   0.0,   0.0 },
    { 10,  1,     -4,     1,   0.0,   0.0 },
    { 10,  2,      2,     0,   0.0,   0.0 },
    { 10,  3,     -5,     3,   0.0,   0.0 },
    { 10,  4,     -2,     6,   0.0,   0.0 },
    { 10,  5,      4,    -4,   0.0,   0.0 },
    { 10,  6,      3,     0,   0.0,   0.0 },
    { 10,  7,      1,    -1,   0.0,   0.0 },
    { 10,  8,      2,     4,   0.0,   0.0 },
    { 10,  9,      3,     0,   0.0,   0.0 },
    { 10, 10,      0,    -6,   0.0,   0.0 },
    { -1, -1,     -1,    -1,  -1.0,  -1.0 }
};

struct igrf1990table    igrf1995[] = {
    /* 参考: http://denali.gsfc.nasa.gov/personal_pages/langlais/publications/Langlais-and-Mandea_2000_eps.pdf */
    /*       IGRF1995 を元に epoch 1997.5 での使用に耐えるように拡張 */
    {  1,  0, -29601,     0,  13.1,   0.0 },
    {  1,  1,  -1763,  5173,   9.3, -25.0 },
    {  2,  0,  -2284,     0, -12.2,   0.0 },
    {  2,  1,   3095, -2474,  -0.4, -23.3 },
    {  2,  2,   1658,  -447,  -2.0,  -8.9 },
    {  3,  0,   1337,     0,   1.7,   0.0 },
    {  3,  1,  -2288,  -207,  -4.1,   7.3 },
    {  3,  2,   1266,   290,   1.8,   0.1 },
    {  3,  3,    749,  -471,  -8.1, -14.9 },
    {  4,  0,    958,     0,  -1.2,   0.0 },
    {  4,  1,    775,   263,   2.4,   2.8 },
    {  4,  2,    251,  -234,  -7.4,   1.0 },
    {  4,  3,   -416,   121,   4.1,   6.4 },
    {  4,  4,    110,  -327,  -2.7,  -0.2 },
    {  5,  0,   -221,     0,  -0.6,   0.0 },
    {  5,  1,    373,    35,  -0.9,  -1.1 },
    {  5,  2,    207,   188,  -3.0,   0.2 },
    {  5,  3,   -139,  -134,  -3.7,   1.3 },
    {  5,  4,   -158,   -52,  -0.7,   2.9 },
    {  5,  5,    -49,   132,   1.3,   0.5 },
    {  6,  0,     74,     0,   0.9,   0.0 },
    {  6,  1,     58,    -5,  -0.4,  -0.1 },
    {  6,  2,     68,    34,   0.3,  -0.9 },
    {  6,  3,   -150,    60,   2.6,   0.7 },
    {  6,  4,    -16,   -49,  -0.6,  -0.4 },
    {  6,  5,     34,    -9,   0.1,   0.0 },
    {  6,  6,    -65,    43,   0.9,   1.2 },
    {  7,  0,     77,     0,   0.3,   0.0 },
    {  7,  1,   -103,   -65,   0.2,   1.6 },
    {  7,  2,     11,   -23,   0.4,  -0.2 },
    {  7,  3,     41,    19,   1.4,   0.3 },
    {  7,  4,      1,    18,   0.9,   0.1 },
    {  7,  5,      7,    27,   0.5,  -1.4 },
    {  7,  6,     12,   -47,   1.5,  -0.5 },
    {  7,  7,     -9,   -13,  -1.4,  -0.2 },
    {  8,  0,     18,     0,  -0.4,   0.0 },
    {  8,  1,     18,     5,  -0.1,  -0.6 },
    {  8,  2,     -1,    -3,  -0.5,   0.1 },
    {  8,  3,    -19,     9,   0.0,  -0.2 },
    {  8,  4,     -8,   -29,  -1.4,  -0.1 },
    {  8,  5,     16,     9,   0.0,   1.0 },
    {  8,  6,     11,    15,  -0.9,  -0.9 },
    {  8,  7,    -14,    -6,  -0.6,   0.6 },
    {  8,  8,    -17,     5,  -1.0,  -0.4 },
    {  9,  0,      4,     0,   0.0,   0.0 },
    {  9,  1,     29,   -21,   0.0,   0.0 },
    {  9,  2,     -1,    11,   0.0,   0.0 },
    {  9,  3,    -17,     3,   0.0,   0.0 },
    {  9,  4,      3,    -8,   0.0,   0.0 },
    {  9,  5,    -14,     1,   0.0,   0.0 },
    {  9,  6,    -11,    11,   0.0,   0.0 },
    {  9,  7,     10,     6,   0.0,   0.0 },
    {  9,  8,      3,   -28,   0.0,   0.0 },
    {  9,  9,     -6,    10,   0.0,   0.0 },
    { 10,  0,      0,     0,   0.0,   0.0 },
    { 10,  1,    -16,     8,   0.0,   0.0 },
    { 10,  2,     -2,   -10,   0.0,   0.0 },
    { 10,  3,      2,     4,   0.0,   0.0 },
    { 10,  4,      3,     9,   0.0,   0.0 },
    { 10,  5,      8,     0,   0.0,   0.0 },
    { 10,  6,      2,   -11,   0.0,   0.0 },
    { 10,  7,      2,    -2,   0.0,   0.0 },
    { 10,  8,      9,    10,   0.0,   0.0 },
    { 10,  9,    -15,     0,   0.0,   0.0 },
    { 10, 10,      6,    -3,   0.0,   0.0 },
    { -1, -1,     -1,    -1,  -1.0,  -1.0 }
};

struct igrf1990table    igrf2000[] = {
    /* 参考: http://swdcdb.kugi.kyoto-u.ac.jp/igrf/coef/igrf2000.txt */
    {  1,  0, -29615,     0,  14.6,   0.0 },
    {  1,  1,  -1728,  5186,  10.7, -22.5 },
    {  2,  0,  -2267,     0, -12.4,   0.0 },
    {  2,  1,   3072, -2478,   1.1, -20.6 },
    {  2,  2,   1672,  -458,  -1.1,  -9.6 },
    {  3,  0,   1341,     0,   0.7,   0.0 },
    {  3,  1,  -2290,  -227,  -5.4,   6.0 },
    {  3,  2,   1253,   296,   0.9,  -0.1 },
    {  3,  3,    715,  -492,  -7.7, -14.2 },
    {  4,  0,    935,     0,  -1.3,   0.0 },
    {  4,  1,    787,   272,   1.6,   2.1 },
    {  4,  2,    251,  -232,  -7.3,   1.3 },
    {  4,  3,   -405,   119,   2.9,   5.0 },
    {  4,  4,    110,  -304,  -3.2,   0.3 },
    {  5,  0,   -217,     0,   0.0,   0.0 },
    {  5,  1,    351,    44,  -0.7,  -0.1 },
    {  5,  2,    222,   172,  -2.1,   0.6 },
    {  5,  3,   -131,  -134,  -2.8,   1.7 },
    {  5,  4,   -169,   -40,  -0.8,   1.9 },
    {  5,  5,    -12,   107,   2.5,   0.1 },
    {  6,  0,     72,     0,   1.0,   0.0 },
    {  6,  1,     68,   -17,  -0.4,  -0.2 },
    {  6,  2,     74,    64,   0.9,  -1.4 },
    {  6,  3,   -161,    65,   2.0,   0.0 },
    {  6,  4,     -5,   -61,  -0.6,  -0.8 },
    {  6,  5,     17,     1,  -0.3,   0.0 },
    {  6,  6,    -91,    44,   1.2,   0.9 },
    {  7,  0,     79,     0,  -0.4,   0.0 },
    {  7,  1,    -74,   -65,  -0.4,   1.1 },
    {  7,  2,      0,   -24,  -0.3,   0.0 },
    {  7,  3,     33,     6,   1.1,   0.3 },
    {  7,  4,      9,    24,   1.1,  -0.1 },
    {  7,  5,      7,    15,  -0.2,  -0.6 },
    {  7,  6,      8,   -25,   0.6,  -0.7 },
    {  7,  7,     -2,    -6,  -0.9,   0.2 },
    {  8,  0,     25,     0,  -0.3,   0.0 },
    {  8,  1,      6,    12,   0.2,   0.1 },
    {  8,  2,     -9,   -22,  -0.3,   0.0 },
    {  8,  3,     -8,     8,   0.4,   0.0 },
    {  8,  4,    -17,   -21,  -1.0,   0.3 },
    {  8,  5,      9,    15,   0.3,   0.6 },
    {  8,  6,      7,     9,  -0.5,  -0.4 },
    {  8,  7,     -8,   -16,  -0.7,   0.3 },
    {  8,  8,     -7,    -3,  -0.4,   0.7 },
    {  9,  0,      5,     0,   0.0,   0.0 },
    {  9,  1,      9,   -20,   0.0,   0.0 },
    {  9,  2,      3,    13,   0.0,   0.0 },
    {  9,  3,     -8,    12,   0.0,   0.0 },
    {  9,  4,      6,    -6,   0.0,   0.0 },
    {  9,  5,     -9,    -8,   0.0,   0.0 },
    {  9,  6,     -2,     9,   0.0,   0.0 },
    {  9,  7,      9,     4,   0.0,   0.0 },
    {  9,  8,     -4,    -8,   0.0,   0.0 },
    {  9,  9,     -8,     5,   0.0,   0.0 },
    { 10,  0,     -2,     0,   0.0,   0.0 },
    { 10,  1,     -6,     1,   0.0,   0.0 },
    { 10,  2,      2,     0,   0.0,   0.0 },
    { 10,  3,     -3,     4,   0.0,   0.0 },
    { 10,  4,      0,     5,   0.0,   0.0 },
    { 10,  5,      4,    -6,   0.0,   0.0 },
    { 10,  6,      1,    -1,   0.0,   0.0 },
    { 10,  7,      2,    -3,   0.0,   0.0 },
    { 10,  8,      4,     0,   0.0,   0.0 },
    { 10,  9,      0,    -2,   0.0,   0.0 },
    { 10, 10,     -1,    -8,   0.0,   0.0 },
    { -1, -1,     -1,    -1,  -1.0,  -1.0 }
};

struct igrf1990table    igrf1985[] = {
    /* 参考: http://www.ipgp.jussieu.fr/~cogne/pub/paleomac/PMhelp/starting/PMdata_files/IGRF1985 */
    {  1,  0, -29877,     0,  23.2,   0.0 },
    {  1,  1,  -1903,  5497,  10.0, -24.5 },
    {  2,  0,  -2073,     0, -13.7,   0.0 },
    {  2,  1,   3045, -2191,   3.4, -11.5 },
    {  2,  2,   1691,  -309,   7.0, -20.2 },
    {  3,  0,   1300,     0,   5.1,   0.0 },
    {  3,  1,  -2208,  -312,  -4.6,   5.3 },
    {  3,  2,   1244,   284,  -0.6,   2.3 },
    {  3,  3,    835,  -296,   0.1, -10.8 },
    {  4,  0,    937,     0,   0.1,   0.0 },
    {  4,  1,    780,   233,  -0.6,   3.8 },
    {  4,  2,    363,  -250,  -7.8,   2.2 },
    {  4,  3,   -426,    68,  -1.4,   2.5 },
    {  4,  4,    169,  -298,  -6.8,   0.9 },
    {  5,  0,   -215,     0,   1.3,   0.0 },
    {  5,  1,    356,    47,   0.1,   0.1 },
    {  5,  2,    253,   148,  -1.5,  -0.2 },
    {  5,  3,    -94,  -155,  -3.2,  -0.1 },
    {  5,  4,   -161,   -75,   0.1,   0.6 },
    {  5,  5,    -48,    95,  -0.1,   0.0 },
    {  6,  0,     52,     0,   1.4,   0.0 },
    {  6,  1,     65,   -16,  -0.3,  -0.4 },
    {  6,  2,     50,    90,   1.7,  -1.1 },
    {  6,  3,   -186,    69,   0.6,  -0.8 },
    {  6,  4,      4,   -50,   0.0,  -2.3 },
    {  6,  5,     17,    -4,   0.9,  -0.5 },
    {  6,  6,   -102,    20,   1.2,  -0.1 },
    {  7,  0,     75,     0,   0.2,   0.0 },
    {  7,  1,    -61,   -82,  -0.6,   0.2 },
    {  7,  2,      2,   -26,  -0.5,   1.0 },
    {  7,  3,     24,    -1,   0.8,   1.1 },
    {  7,  4,     -6,    23,   1.0,   1.9 },
    {  7,  5,      4,    17,   0.4,   0.3 },
    {  7,  6,      9,   -21,  -0.5,   0.2 },
    {  7,  7,      0,    -6,  -0.1,   0.9 },
    {  8,  0,     21,     0,   0.7,   0.0 },
    {  8,  1,      6,     7,   0.0,   0.1 },
    {  8,  2,      0,   -21,   0.3,  -1.0 },
    {  8,  3,    -11,     5,   0.4,   0.1 },
    {  8,  4,     -9,   -25,  -0.3,  -0.8 },
    {  8,  5,      2,    11,  -0.3,   0.2 },
    {  8,  6,      4,    12,   0.1,  -0.8 },
    {  8,  7,      4,   -16,  -0.5,  -0.1 },
    {  8,  8,     -6,   -10,  -0.8,   1.3 },
    {  9,  0,      5,     0,   0.0,   0.0 },
    {  9,  1,     10,   -21,   0.0,   0.0 },
    {  9,  2,      1,    16,   0.0,   0.0 },
    {  9,  3,    -12,     9,   0.0,   0.0 },
    {  9,  4,      9,    -5,   0.0,   0.0 },
    {  9,  5,     -3,    -6,   0.0,   0.0 },
    {  9,  6,     -1,     9,   0.0,   0.0 },
    {  9,  7,      7,    10,   0.0,   0.0 },
    {  9,  8,      2,    -6,   0.0,   0.0 },
    {  9,  9,     -5,     2,   0.0,   0.0 },
    { 10,  0,     -4,     0,   0.0,   0.0 },
    { 10,  1,     -4,     1,   0.0,   0.0 },
    { 10,  2,      2,     0,   0.0,   0.0 },
    { 10,  3,     -5,     3,   0.0,   0.0 },
    { 10,  4,     -2,     6,   0.0,   0.0 },
    { 10,  5,      5,    -4,   0.0,   0.0 },
    { 10,  6,      3,     0,   0.0,   0.0 },
    { 10,  7,      1,    -1,   0.0,   0.0 },
    { 10,  8,      2,     4,   0.0,   0.0 },
    { 10,  9,      3,     0,   0.0,   0.0 },
    { 10, 10,      0,    -6,   0.0,   0.0 },
    { -1, -1,     -1,    -1,  -1.0,  -1.0 }
};

struct igrf1990table    igrf1980[] = {
    /* 参考: http://www.ipgp.jussieu.fr/~cogne/pub/paleomac/PMhelp/starting/PMdata_files/IGRF1980 */
    {  1,  0, -29988,     0,  20.4,   0.0 },
    {  1,  1,  -1958,  5607,   8.9,  -9.1 },
    {  2,  0,  -1997,     0, -19.4,   0.0 },
    {  2,  1,   3028, -2129,   5.1, -18.6 },
    {  2,  2,   1663,  -199,   9.9, -26.4 },
    {  3,  0,   1280,     0,   4.7,   0.0 },
    {  3,  1,  -2181,  -336,  -3.6,  -5.7 },
    {  3,  2,   1251,   271,  -2.2,   1.5 },
    {  3,  3,    833,  -252,   3.9,  -6.9 },
    {  4,  0,    937,     0,  -2.3,   0.0 },
    {  4,  1,    782,   212,  -2.4,   3.6 },
    {  4,  2,    397,  -257, -10.1,   1.1 },
    {  4,  3,   -420,    52,  -3.9,   6.7 },
    {  4,  4,    198,  -298,  -5.6,  -2.7 },
    {  5,  0,   -217,     0,  -1.1,   0.0 },
    {  5,  1,    357,    45,  -0.9,   3.3 },
    {  5,  2,    261,   150,  -0.7,   0.5 },
    {  5,  3,    -74,  -151,  -4.8,  -0.8 },
    {  5,  4,   -162,   -78,   0.1,   1.2 },
    {  5,  5,    -48,    92,   1.4,   0.8 },
    {  6,  0,     49,     0,   0.8,   0.0 },
    {  6,  1,     65,   -15,  -0.0,   0.0 },
    {  6,  2,     42,    93,   3.5,  -1.2 },
    {  6,  3,   -192,    71,   2.2,  -1.0 },
    {  6,  4,      4,   -43,   0.4,   0.1 },
    {  6,  5,     14,    -2,   1.8,   0.5 },
    {  6,  6,   -107,    18,   1.5,   2.9 },
    {  7,  0,     71,     0,   0.1,   0.0 },
    {  7,  1,    -58,   -83,  -0.4,  -1.4 },
    {  7,  2,      1,   -27,   0.0,  -0.0 },
    {  7,  3,     20,    -6,   0.4,   0.2 },
    {  7,  4,    -13,    16,   0.9,   0.6 },
    {  7,  5,      1,    18,   0.2,  -0.4 },
    {  7,  6,     11,   -24,  -0.2,   0.1 },
    {  7,  7,     -3,   -10,   0.0,   0.5 },
    {  8,  0,     19,     0,   0.6,   0.0 },
    {  8,  1,      7,     7,   0.1,  -0.1 },
    {  8,  2,      1,   -18,   0.2,  -0.3 },
    {  8,  3,    -11,     3,   0.1,  -0.1 },
    {  8,  4,     -7,   -22,  -0.2,  -0.3 },
    {  8,  5,      4,     9,  -0.4,   0.3 },
    {  8,  6,      4,    16,   0.5,  -0.6 },
    {  8,  7,      7,   -13,  -0.5,  -0.7 },
    {  8,  8,     -1,   -15,  -0.2,   0.1 },
    {  9,  0,      5,     0,  -0.3,   0.0 },
    {  9,  1,     11,   -22,   0.2,   0.1 },
    {  9,  2,      1,    16,  -0.0,   0.1 },
    {  9,  3,    -12,     9,   0.0,   0.2 },
    {  9,  4,      9,    -5,  -0.1,  -0.2 },
    {  9,  5,     -4,    -8,  -0.3,  -0.3 },
    {  9,  6,     -1,     9,  -0.1,  -0.1 },
    {  9,  7,      7,    11,   0.3,  -0.1 },
    {  9,  8,      2,    -5,   0.0,  -0.3 },
    {  9,  9,     -5,     2,  -0.5,   0.1 },
    { 10,  0,     -3,     0,  -0.1,   0.0 },
    { 10,  1,     -4,     1,  -0.1,  -0.1 },
    { 10,  2,      3,     0,   0.0,  -0.1 },
    { 10,  3,     -5,     3,  -0.1,   0.1 },
    { 10,  4,     -2,     6,   0.0,  -0.1 },
    { 10,  5,      5,    -4,   0.0,  -0.0 },
    { 10,  6,      3,    -1,  -0.2,  -0.1 },
    { 10,  7,      1,    -1,   0.2,   0.1 },
    { 10,  8,      2,     4,   0.1,   0.1 },
    { 10,  9,      3,    -1,   0.1,  -0.1 },
    { 10, 10,     -0,    -6,   0.0,  -0.0 },
    { -1, -1,     -1,    -1,  -1.0,  -1.0 }
};

struct igrf1990table    igrf2005[] = {
    /* 参考: http://www.pcmaritime.co.uk/public/Igrf2005.dat */
    {  0,  1, -29557,     0,   8.8,   0.0 },
    {  1,  1,  -1672,  5080,  10.8, -21.3 },
    {  0,  2,  -2341,     0, -15.0,   0.0 },
    {  1,  2,   3047, -2595,  -6.9, -23.3 },
    {  2,  2,   1657,  -517,  -1.0, -14.0 },
    {  0,  3,   1336,     0,  -0.3,   0.0 },
    {  1,  3,  -2305,  -200,  -3.1,   5.4 },
    {  2,  3,   1247,   269,  -0.9,  -6.5 },
    {  3,  3,    674,  -525,  -6.8,  -2.0 },
    {  0,  4,    920,     0,  -2.5,   0.0 },
    {  1,  4,    798,   281,   2.8,   2.0 },
    {  2,  4,    212,  -226,  -7.1,   1.8 },
    {  3,  4,   -380,   146,   5.9,   5.6 },
    {  4,  4,    100,  -305,  -3.2,   0.0 },
    {  0,  5,   -228,     0,  -2.6,   0.0 },
    {  1,  5,    354,    43,   0.4,   0.1 },
    {  2,  5,    209,   180,  -3.0,   1.8 },
    {  3,  5,   -137,  -123,  -1.2,   2.0 },
    {  4,  5,   -168,   -20,   0.2,   4.5 },
    {  5,  5,    -14,   104,  -0.6,  -1.0 },
    {  0,  6,     73,     0,  -0.8,   0.0 },
    {  1,  6,     70,   -20,   0.2,  -0.4 },
    {  2,  6,     77,    55,  -0.2,  -1.9 },
    {  3,  6,   -151,    64,   2.1,  -0.4 },
    {  4,  6,    -15,   -63,  -2.1,  -0.4 },
    {  5,  6,     15,     0,  -0.4,  -0.2 },
    {  6,  6,    -86,    50,   1.3,   0.9 },
    {  0,  7,     80,     0,  -0.4,   0.0 },
    {  1,  7,    -74,   -61,   0.0,   0.8 },
    {  2,  7,     -1,   -23,  -0.2,   0.4 },
    {  3,  7,     39,     7,   1.1,   0.1 },
    {  4,  7,     12,    25,   0.6,   0.2 },
    {  5,  7,      9,    11,   0.4,  -0.9 },
    {  6,  7,      6,   -26,  -0.5,  -0.3 },
    {  7,  7,      2,    -5,   0.9,   0.3 },
    {  0,  8,     25,     0,  -0.2,   0.0 },
    {  1,  8,      8,    11,   0.2,  -0.2 },
    {  2,  8,    -11,   -21,  -0.2,   0.2 },
    {  3,  8,     -7,    10,   0.2,   0.2 },
    {  4,  8,    -18,   -20,  -0.2,   0.4 },
    {  5,  8,     10,    16,   0.2,   0.2 },
    {  6,  8,      9,     8,   0.5,  -0.3 },
    {  7,  8,    -11,   -13,  -0.7,   0.5 },
    {  8,  8,     -5,    -0,   0.5,   0.4 },
    {  0,  9,      6,     0,   0.0,   0.0 },
    {  1,  9,     10,   -20,   0.0,   0.0 },
    {  2,  9,      4,    13,   0.0,   0.0 },
    {  3,  9,     -7,    13,   0.0,   0.0 },
    {  4,  9,      5,    -7,   0.0,   0.0 },
    {  5,  9,    -11,    -8,   0.0,   0.0 },
    {  6,  9,     -1,     8,   0.0,   0.0 },
    {  7,  9,      9,     3,   0.0,   0.0 },
    {  8,  9,     -7,    -8,   0.0,   0.0 },
    {  9,  9,     -9,     6,   0.0,   0.0 },
    {  0, 10,     -2,     0,   0.0,   0.0 },
    {  1, 10,     -6,     2,   0.0,   0.0 },
    {  2, 10,      2,     0,   0.0,   0.0 },
    {  3, 10,     -3,     4,   0.0,   0.0 },
    {  4, 10,     -0,     5,   0.0,   0.0 },
    {  5, 10,      3,    -7,   0.0,   0.0 },
    {  6, 10,      0,    -1,   0.0,   0.0 },
    {  7, 10,      2,    -3,   0.0,   0.0 },
    {  8, 10,      4,    -1,   0.0,   0.0 },
    {  9, 10,     -0,    -2,   0.0,   0.0 },
    { 10, 10,     -2,    -8,   0.0,   0.0 },
    { -1, -1,     -1,    -1,  -1.0,  -1.0 }
};

static double   __x0 = 0.0, __y0 = 0.0, __z0 = 0.0;
#ifdef  DEBUG
static double   I, si, ccd, csd, tp;
#endif

static double   igrfsub _(( double latitude, double longitude, double t0, double t6 ));
static void     fieldsub _(( int n9, double latitude, double longitude ));

/*
 *  igrf
 *         引数 : year      = 西暦年
 *                month     = 月
 *                day       = 日
 *                latitude  = 緯度 (北緯のとき正の値、南緯のとき負の値)
 *                longitude = 経度 (東経のとき正の値、西経のとき負の値)
 * 参照大域変数 : days      = 1月1日から各月の1日までの経過日数のテーブル
 *       戻り値 : ret       = 磁気偏差 (単位: Deg; 正のとき東に、負のと
 *                            き西にずれていることを示す)
 *         注意 : 指定年月日の指定場所(緯度、経度で指定)での磁気偏差を求
 *                める。磁気偏差の算出は IGRF (International Geomagnetic
 *                Reference Field, 1991 Revision) で提示されている公式を
 *                利用している
 */

double
igrf( int    year,          /* 年(西暦年の下2桁)                        */
      int    month,         /* 月                                       */
      int    day,           /* 日                                       */
      double latitude,      /* 緯度(北緯のとき正の値、南緯のとき負の値) */
      double longitude )    /* 経度(東経のとき正の値、西経のとき負の値) */
{
    int     daynum;             /* 1月1日からの経過日数 */
    int     daysInYear = 365;   /* 1年の日数            */
    double  t0, t6;             /* ユリウス年           */
    double  d;                  /* 磁気偏差             */
    double  ret;                /* 戻り値格納用         */

    daynum = day + days[month - 1];
    if (isLeapYear(year)) {     /* 閏年の場合 */
        daysInYear++;
        if (month >= 3) {
            daynum++;
        }
    }
    t6 = ((year - 1900) * 1.0) + (daynum * 1.0) / (daysInYear * 1.0);
    if ( year <= 1985 )
        t0 = 80.0;  /* 1980.0 年 */
    else if ( year <= 1990 )
        t0 = 85.0;  /* 1985.0 年 */
    else if ( year <= 1995 )
        t0 = 90.0;  /* 1990.0 年 */
    else if ( year <= 2000 )
        t0 = 95.0;  /* 1995.0 年 */
    else if ( year <= 2005 )
        t0 = 100.0; /* 2000.0 年 */
    else /* if ( year <= 2010 )  */
        t0 = 105.0; /* 2005.0 年 */

    d = igrfsub(latitude, longitude, t0, t6);

#ifdef  DEBUG
    printf( "%04d/%02d/%02d\n", year, month, day );
    printf( "Latitude    = %f\n", latitude );
    printf( "Longitude   = %f\n", longitude );
    printf( "Proton      = %f(nT)\n", 0.0 );
    printf( "Total Field = %f(nT)\n", tp );
    printf( "     T.ANO. = %f(nT)\n", 0.0 );
    printf( "X Component = %f(nT)\n", __x0 );
    printf( "    X Comp. = %f(nT)\n", 0.0 / ccd );
    printf( "Y Component = %f(nT)\n", __y0 );
    printf( "    Y Comp. = %f(nT)\n", 0.0 / csd );
    printf( "Z Component = %f(nT)\n", __z0 );
    printf( "    Z Comp. = %f(nT)\n", 0.0 / si );
    printf( "I = %f(Deg.) / D = %f(Deg.)\n", I, d );
    printf( "    %d度%f分 / ",
            irint(floor(I)),  (I - irint(floor(I)) * 1.0) * 60.0 );
    printf( "%d度%f分%c\n",
            d > 180.0 ? irint(floor(360.0 - d)) : irint(floor(d)),
            d > 180.0 ? ((360.0 - d) - irint(floor(360.0 - d)) * 1.0) * 60.0
                      : (d - irint(floor(d)) * 1.0) * 60.0,
            d > 180.0 ? 'w' : 'e' );
    printf( "SI = %f / CI*CD = %f, CI*SD = %f\n", si, ccd, csd );
#endif
#ifdef  TEST
    printf( "%d度%f分%c\n",
            d > 180.0 ? irint(floor(360.0 - d)) : irint(floor(d)),
            d > 180.0 ? ((360.0 - d) - irint(floor(360.0 - d)) * 1.0) * 60.0
                      : (d - irint(floor(d)) * 1.0) * 60.0,
            d > 180.0 ? 'w' : 'e' );
#endif
#ifdef  TAMO
    printf( "%2d度%9.6f分%c",
            d > 180.0 ? irint(floor(360.0 - d)) : irint(floor(d)),
            d > 180.0 ? ((360.0 - d) - irint(floor(360.0 - d)) * 1.0) * 60.0
                      : (d - irint(floor(d)) * 1.0) * 60.0,
            d > 180.0 ? 'w' : 'e' );
#endif

    ret = d > 180.0 ? d - 360.0 : d;
    return ( ret );
}


/*
 *  igrfsub
 *         引数 : latitude  = 緯度 (北緯のとき正の値、南緯のとき負の値)
 *                longitude = 経度 (東経のとき正の値、西経のとき負の値)
 *                t0        = 1990年1月1日の(簡易)ユリウス年
 *                t6        = 磁気偏差を求めたい日の(簡易)ユリウス年
 * 参照大域変数 : igrf1980  = IGRF 1980.0 model のパラメータテーブル
 *                igrf1985  = IGRF 1985.0 model のパラメータテーブル
 *                igrf1990  = IGRF 1990.0 model のパラメータテーブル
 *                igrf1995  = IGRF 1995.0 model のパラメータテーブル
 *                igrf2000  = IGRF 2000.0 model のパラメータテーブル
 *                igrf2005  = IGRF 2005.0 model のパラメータテーブル
 *       戻り値 : d         = 磁気偏差 (単位: Deg; 0 〜 360)
 *         注意 : 指定年月日の指定場所(緯度、経度で指定)での磁気偏差を求
 *                める。磁気偏差の算出は IGRF (International Geomagnetic
 *                Reference Field, 1991 Revision) で提示されている公式を
 *                利用している
 */

static double   t5, t7, t9;
static double   g0[11][11], h0[11][11], s0[11][11];

#define G0(i,j) g0[(i)-1][(j)-1]
#define H0(i,j) h0[(i)-1][(j)-1]
#define S0(i,j) s0[(i)-1][(j)-1]

static double
igrfsub( double latitude, double longitude, double t0, double t6 )
{
    double                  d;  /* 磁気偏差 */
    double                  t, u1, u2, u3;
    int                     i, n, m9;
    struct igrf1990table    *ip;
    int                     size;

    t = t6 - t0;

    S0(1,1) = -1.0;
    for ( i = 2; i <= 11; i++ ) {
        S0(i,1) = S0(i-1,1) * (2 * i - 3) / ((i - 1) * 1.0);
        n = 2;
        for ( m9 = 2; m9 <= i; m9++ ) {
            S0(i,m9) = S0(i,m9-1) * sqrt((((i-m9+1) * n)*1.0)/((i+m9-2)*1.0));
            n = 1;
        }
    }

    switch ( (int)t0 ) {
    case 80:    /* IGRF1980 */
        size = sizeof ( igrf1980 ) / sizeof ( struct igrf1990table );
        ip   = &igrf1985[0];
        break;
    case 85:    /* IGRF1985 */
        size = sizeof ( igrf1985 ) / sizeof ( struct igrf1990table );
        ip   = &igrf1985[0];
        break;
    case 90:    /* IGRF1990 */
        size = sizeof ( igrf1990 ) / sizeof ( struct igrf1990table );
        ip   = &igrf1990[0];
        break;
    case 95:    /* IGRF1995 */
        size = sizeof ( igrf1995 ) / sizeof ( struct igrf1990table );
        ip   = &igrf1995[0];
        break;
    case 100:   /* IGRF2000 */
        size = sizeof ( igrf2000 ) / sizeof ( struct igrf1990table );
        ip   = &igrf2000[0];
        break;
    case 105:   /* IGRF2005 */
        size = sizeof ( igrf2005 ) / sizeof ( struct igrf1990table );
        ip   = &igrf2005[0];
        break;
    }

    for (i = 0; i < size; i++, ip++ ) {
        if ( ip->n < 0 ) {
            break;
        }
        n  = ip->n + 1;
        m9 = ip->m + 1;
        G0(n,m9) = (ip->g1 * 1.0 + ip->g2 * t) * S0(n,m9);
        H0(n,m9) = (ip->h1 * 1.0 + ip->h2 * t) * S0(n,m9);
    }

    fieldsub(n, latitude, longitude);
                                  /* X,Y,Z各方向の磁気ポテンシャルを求める */
    __x0 = -t7;                   /* X方向の磁気ポテンシャル */
    __y0 = t5;                    /* Y方向の磁気ポテンシャル */
    __z0 = -t9;                   /* Z方向の磁気ポテンシャル */
    u2   = latitude/(180.0/M_PI); /* Deg. → radian */
    u1   = sin(u2) / sqrt(1.01353 * cos(u2) * cos(u2) + sin(u2) * sin(u2));
    u3   = atan(sqrt(1.0 - u1 * u1) / u1);
    if ( sin(u2) < 0.0 ) {
        u3 += M_PI;
    }
#ifdef  M_PI_2
    u1   = u2 + u3 - M_PI_2;
#else
    u1   = u2 + u3 - M_PI / 2;
#endif
    u2   = __x0 * cos(u1) + __z0 * sin(u1);
    u3   = -__x0 * sin(u1) + __z0 * cos(u1);
    __x0 = u2;
    __z0 = u3;
    d = atan(__y0 / __x0);
    if ( __x0 < 0.0 ) {
        d += M_PI;
    }
    if ( __y0 < 0.0 ) {
        d += M_PI * 2;
    }
#ifdef  DEBUG
    I   = atan(__z0 / sqrt(__x0 * __x0 + __y0 * __y0));
    si  = sin(I);
    ccd = cos(I) * cos(d);
    csd = cos(I) * sin(d);
#endif
    d *= 180.0 / M_PI;          /* radian → Deg. 変換 */
#ifdef  DEBUG
    I *= 180.0 / M_PI;          /* radian → Deg. 変換 */
    tp = sqrt(__x0 * __x0 + __y0 * __y0 + __z0 * __z0);
#endif

    return ( d );
}


/*
 *  fieldsub
 *         引数 : n9        = パラメータテーブルの大きさ
 *                latitude  = 緯度
 *                longitude = 経度
 * 参照大域変数 : t5 = Y方向の磁気ポテンシャル (単位: nT)
 *                t7 = X方向の磁気ポテンシャル (単位: nT)
 *                t9 = Z方向の磁気ポテンシャル (単位: nT)
 *       戻り値 : なし
 *         注意 : X,Y,Z各方向の磁気ポテンシャルを求める
 */

static double   p0[11][11], d0[11][11], c0[11][11], c6[11], s6[11];
static int      f6[11], f7[11];

#define P0(i,j) p0[(i)-1][(j)-1]
#define D0(i,j) d0[(i)-1][(j)-1]
#define C0(i,j) c0[(i)-1][(j)-1]
#define C6(i)   c6[(i)-1]
#define S6(i)   s6[(i)-1]
#define F6(i)   f6[(i)-1]
#define F7(i)   f7[(i)-1]

static void
fieldsub( int n9, double latitude, double longitude )
{
    int     n, m;
    double  a0, a1, a2, a6, b2, c1, c2, c9, d2, f1, f2;
    double  r0, rr, p6, t4, s1, s9;

#if     1
    a1 = 6378.160;                  /* 地球の赤道半径 (IAU楕円体 1964)   */
#else
    a1 = 6378.140;                  /* 地球の赤道半径 (IAU楕円体 1976)   */
 /* a1 = 6378.136;                  $* 地球の赤道半径 (IAG, 1983 Aug)    */
#endif
    r0 = 180.0 / M_PI;              /* radian (180/π)                   */
    f1 = 297.25 / 298.25;           /* 地球のへん平率 = 1/298.25 (1964)  */
                                    /*             1/298.257 (1976,1983) */
                                    /* 潮汐を考慮すると 1/298.2532       */
    a2 = a1 * a1;
    b2 = a2 * a2;
    f2 = f1 * f1;
    s9 = sin(longitude / r0);
    c9 = cos(longitude / r0);
    c1 = sin(latitude  / r0);
    c2 = c1 * c1;
    d2 = a2 - (a2 * (1.0 - f2)) * c2;
 /* d1 = sqrt(d2); */
    c1 /= sqrt((1.0 / (f2 * f2)) * (1.0 - c2) + c2);
    rr = sqrt((b2 - (b2 * (1.0 - f2 * f2)) * c2) / d2);

    P0(1,1) = 1.0;
    D0(1,1) = 0.0;
    S6(1) = 0.0;
    C6(1) = 1.0;

    for ( n = 2; n <= 11; n++ ) {
        F7(n) = n;
        for ( m = 1; m <= n; m++ ) {
            F6(m) = m - 1;
            C0(n,m) = ((n * 1.0 - 2.0) * (n * 1.0 - 2.0) -
                       (m * 1.0 - 1.0) * (m * 1.0 - 1.0)) /
                           ((2.0 * n - 3.0) * (2.0 * n - 5.0));
        }
    }

    s1 = sqrt(1.0 - c1 * c1);
    C0(2,2) = 0.0;
    S6(2) = s9;
    C6(2) = c9;
    P0(2,1) = c1;
    P0(2,2) = s1;
    D0(2,1) = -s1;
    D0(2,2) = c1;

    for ( m = 3; m <= n9; m++ ) {
        S6(m) = S6(2) * C6(m - 1) + C6(2) * S6(m - 1);
        C6(m) = C6(2) * C6(m - 1) - S6(2) * S6(m - 1);
    }

    a0 = 6371.2 / rr;
    a6 = a0 * a0;
    t7 = 0.0;
    t5 = 0.0;
    t9 = 0.0;

    for ( n = 3; n <= n9; n++ ) {
        for ( m = 1; m <= n; m++ ) {
            if ( n == m ) {
                P0(n,n) = s1 * P0(n-1,n-1);
                D0(n,n) = s1 * D0(n-1,n-1) + c1 * P0(n-1,n-1);
            }
            else {
                P0(n,m) = c1 * P0(n-1,m) - C0(n,m) * P0(n-2,m);
                D0(n,m) = c1 * D0(n-1,m) - s1 * P0(n-1,m) -
                              C0(n,m) * D0(n-2,m);
            }
        }
    }

    for ( n = 2; n <= n9; n++ ) {
        a6 *= a0;
        for ( m = 1; m <= n; m++ ) {
            p6 = P0(n,m) * a6;
            t4 = G0(n,m) * C6(m) + H0(n,m) * S6(m);
            t7 += t4 * D0(n,m) * a6;
            t5 -= (G0(n,m) * S6(m) - H0(n,m) * C6(m)) * F6(m) * p6;
            t9 -= t4 * F7(n) * p6;
        }
    }

    t5 /= s1;
 /* t = sqrt(t7 * t7 + t9 * t9 + t5 * t5); */
}


#ifdef  TEST

#include <time.h>

int
main()
{
    time_t      t = time( (time_t *)0L );
    struct tm   *tm;
    int         yy, mm, dd;

    tm = localtime( &t );
    yy = tm->tm_year + 1900;
    mm = tm->tm_mon  + 1;
    dd = tm->tm_mday;

    printf( "稚内:   " );
    igrf(yy, mm, dd, 45.378, 141.722);  /* 稚内   */
    printf( "鹿児島: " );
    igrf(yy, mm, dd, 31.395, 130.180);  /* 鹿児島 */

    printf( "-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=\n\n" );
    printf( "東京" );
    igrf( yy, mm, dd, 35.00 + 39.00/60.00, 139.00 + 45.00/60.00 );

    printf( "名古屋" );
    igrf( yy, mm, dd, 35.00 + 10.00/60.00, 136.00 + 55.00/60.00 );
    printf( "-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=\n\n" );

    igrf(yy, mm, dd, 20.450, 145.370);

    igrf(yy, mm, dd, 40.000, 130.000);
    igrf(yy, mm, dd, 40.000, 135.000);
    igrf(yy, mm, dd, 40.000, 145.000);
    igrf(yy, mm, dd, 40.000, 150.000);
    igrf(yy, mm, dd, 40.000, 155.000);
    igrf(yy, mm, dd, 40.000, 160.000);
    igrf(yy, mm, dd, 40.000, 165.000);
    igrf(yy, mm, dd, 30.000, 125.000);
    igrf(yy, mm, dd, 30.000, 130.000);
    igrf(yy, mm, dd, 30.000, 135.000);
    igrf(yy, mm, dd, 30.000, 140.000);
    igrf(yy, mm, dd, 30.000, 145.000);
    igrf(yy, mm, dd, 30.000, 150.000);
    igrf(yy, mm, dd, 30.000, 155.000);
    igrf(yy, mm, dd, 30.000, 160.000);
    igrf(yy, mm, dd, 30.000, 165.000);

    igrf(yy, mm, dd, -30.000, 165.000);
    igrf(yy, mm, dd, -30.000, -165.000);
    igrf(yy, mm, dd, 30.000, -165.000);

    return ( 1 );
}
#endif


#ifdef  TAMO

void
tamo_igrf( long yy, long mm, long dd, int htmlMode )
{
    if ( htmlMode == ON )
        fputs(
            "<TABLE BORDER=\"0\" SUMMARY=\"磁気偏差\"><TR><TD COLSPAN=\"7\">",
               stdout );
    else
        putchar( '\n' );

    printf( "磁気偏差 (IGRF%sモデルを適用)\n",
            (yy <= 1985) ?    "1980"    :
            (yy <= 1990) ?    "1985"    :
            (yy <= 1995) ?    "1990"    :
            (yy <= 2000) ?    "1995"    :
            (yy <= 2005) ?    "2000"    :
         /* (yy <= 2010) ? */ "2005" /* :
                              "2010" */   );
    if ( htmlMode == ON )
        fputs( "</TD></TR>\n<TR><TD WIDTH=\"10\"><BR></TD><TD WIDTH=\"40\">",
               stdout );

    fputs( "  東京   ", stdout );
    if ( htmlMode == ON )
        fputs( "</TD><TD WIDTH=\"120\">", stdout );
    igrf( yy, mm, dd, 35.00 + 39.00/60.00, 139.00 + 45.00/60.00 );
    if ( htmlMode == ON )
        fputs( "</TD><TD WIDTH=\"40\">", stdout );

    fputs( "   名古屋 ", stdout );
    if ( htmlMode == ON )
        fputs( "</TD><TD WIDTH=\"120\">", stdout );
    igrf( yy, mm, dd, 35.00 + 10.00/60.00, 136.00 + 55.00/60.00 );
  /*
    if ( htmlMode == ON )
        fputs( "</TD><TD WIDTH=\"40\">", stdout );

    fputs( "   大阪   ", stdout );
    if ( htmlMode == ON )
        fputs( "</TD><TD WIDTH=\"120\">", stdout );
    igrf( yy, mm, dd, 34.00 + 41.00/60.00, 135.00 + 29.00/60.00 );
  */
    if ( htmlMode == ON )
        fputs( "</TD></TR>\n<TR><TD WIDTH=\"10\"><BR></TD><TD WIDTH=\"40\">",
               stdout );
    else
        putchar( '\n' );

    fputs( "  根室   ", stdout );
    if ( htmlMode == ON )
        fputs( "</TD><TD WIDTH=\"120\">", stdout );
    igrf( yy, mm, dd, 43.00 + 20.00/60.00, 145.00 + 35.00/60.00 );
    if ( htmlMode == ON )
        fputs( "</TD><TD WIDTH=\"40\">", stdout );
  /*
    fputs( "   金沢   ", stdout );
    if ( htmlMode == ON )
        fputs( "</TD><TD WIDTH=\"120\">", stdout );
    igrf( yy, mm, dd, 36.00 + 34.00/60.00, 136.00 + 39.00/60.00 );
    if ( htmlMode == ON )
        fputs( "</TD><TD WIDTH=\"40\">", stdout );
  */
    fputs( "   那覇   ", stdout );
    if ( htmlMode == ON )
        fputs( "</TD><TD WIDTH=\"120\">", stdout );
    igrf( yy, mm, dd, 26.00 + 13.00/60.00, 127.00 + 40.00/60.00 );
    if ( htmlMode == ON )
        fputs( "</TD></TR>", stdout );
    else
        putchar( '\n' );

    if ( htmlMode == ON )
        fputs( "</TABLE>", stdout );
    putchar( '\n' );
}

#endif
